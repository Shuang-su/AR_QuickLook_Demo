<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARè¡Œæ”¿æ¥¼é¢„è§ˆ</title>
    
    <!-- å†…ç½®åŠ è½½åŠ¨ç”» -->
    <style>
        /* æ—‹è½¬åŠ¨ç”» */
        .loading-spinner {
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        /* è’™ç‰ˆå±‚æ ·å¼ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .overlay-content {
            text-align: center;
            color: white;
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç•Œé¢ -->
    <div class="loading-container">
        <svg class="loading-spinner" viewBox="0 0 50 50">
            <circle cx="25" cy="25" r="20" fill="none" stroke="#007AFF" stroke-width="4" stroke-linecap="round" 
                    stroke-dasharray="31.415, 31.415" />
        </svg>
        <p class="status-text" id="loading-text">æ¨¡å‹åŠ è½½ä¸­...</p>
    </div>

    <!-- è’™ç‰ˆå¼•å¯¼å±‚ -->
    <div class="overlay" id="overlay">
        <div class="overlay-content">
            <h2>ARä½“éªŒå‡†å¤‡å°±ç»ªï¼</h2>
            <p>è½»è§¦å±å¹•ä»»æ„ä½ç½®å¯åŠ¨å¢å¼ºç°å®</p>
            <button id="start-ar" style="margin-top:20px; padding:12px 24px; background:#007AFF; color:white; border:none; border-radius:8px;">
                ğŸš€ ç«‹å³ä½“éªŒ
            </button>
        </div>
    </div>

    <script>
        // è®¾å¤‡æ£€æµ‹
        const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        let modelLoaded = false;

        // é¢„åŠ è½½USDZæ–‡ä»¶
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'xingzhenglou.usdz', true);
        xhr.responseType = 'blob';

        xhr.onprogress = (e) => {
            if (e.lengthComputable) {
                const percent = Math.round((e.loaded / e.total) * 100);
                document.getElementById('loading-text').textContent = 
                    `æ¨¡å‹åŠ è½½ä¸­... ${percent}% (${(e.loaded/1024/1024).toFixed(1)}MB/${(e.total/1024/1024).toFixed(1)}MB)`;
            }
        };

        xhr.onload = () => {
            modelLoaded = true;
            document.querySelector('.loading-container').style.display = 'none';
            showAROverlay();
        };

        xhr.send();

        // æ˜¾ç¤ºARå¼•å¯¼å±‚
        function showAROverlay() {
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'flex';
            
            // ç‚¹å‡»è’™ç‰ˆè§¦å‘AR
            overlay.addEventListener('click', function handler(e) {
                if (!modelLoaded) return;
                
                // ç§»é™¤äº‹ä»¶ç›‘å¬é¿å…é‡å¤è§¦å‘
                overlay.removeEventListener('click', handler);
                
                // æ­£å¼è§¦å‘AR
                triggerAR();
            });
        }

        // å®é™…è§¦å‘ARçš„æ–¹æ³•
        function triggerAR() {
            const arLink = document.createElement('a');
            arLink.href = 'xingzhenglou.usdz';
            arLink.rel = 'ar';
            document.body.appendChild(arLink);
            
            try {
                arLink.click();
                document.getElementById('overlay').style.display = 'none';
            } catch (e) {
                alert('ARå¯åŠ¨å¤±è´¥ï¼Œè¯·ç¡®ä¿ä½¿ç”¨Safariæµè§ˆå™¨');
            }
        }

        // è¶…æ—¶å¤„ç†ï¼ˆ15ç§’ï¼‰
        setTimeout(() => {
            if (!modelLoaded) {
                document.getElementById('loading-text').innerHTML = 
                    'åŠ è½½æ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®ï¼š<br>1. æ£€æŸ¥ç½‘ç»œè¿æ¥<br>2. åˆ·æ–°é¡µé¢';
            }
        }, 15000);
    </script>
</body>
</html>