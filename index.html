<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARè¡Œæ”¿æ¥¼é¢„è§ˆ</title>
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="xingzhenglou.usdz" as="fetch">
    <link rel="preload" href="loading.gif" as="image">

    <!-- æ ·å¼ -->
    <style>
        :root {
            --primary-color: #007AFF;
            --text-color: #333;
        }

        body {
            font-family: -apple-system, sans-serif;
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
        }

        /* åŠ è½½åŠ¨ç”»å®¹å™¨ */
        .loading-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }

        /* ARæŒ‰é’®äº¤äº’æ•ˆæœ */
        .ar-button {
            display: none; /* é»˜è®¤éšè— */
            margin: 30px auto;
            padding: 20px 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 15px;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .ar-button:hover {
            transform: translateY(-2px);
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            width: 200px;
            height: 4px;
            background: #ddd;
            margin: 20px auto;
            border-radius: 2px;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        /* çŠ¶æ€æç¤º */
        .status-text {
            color: var(--text-color);
            margin: 15px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading-container">
        <img src="loading.gif" alt="åŠ è½½ä¸­" width="60">
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <p class="status-text" id="loading-text">æ¨¡å‹åŠ è½½ä¸­... (0%)</p>
    </div>

    <!-- ä¸»å†…å®¹ï¼ˆåˆå§‹éšè—ï¼‰ -->
    <div id="main-content" style="display: none;">
        <h1>è¡Œæ”¿æ¥¼ARé¢„è§ˆ</h1>
        <p class="status-text">âœ… æ¨¡å‹å·²å‡†å¤‡å°±ç»ª</p>
        
        <a href="xingzhenglou.usdz" rel="ar" class="ar-button" id="ar-button">
            <img src="placeholder.jpg" alt="ARé¢„è§ˆ" style="width: 280px; border-radius: 8px;">
            <p style="margin-top: 10px;">ç‚¹å‡»å¯åŠ¨ARä½“éªŒ</p>
        </a>

        <div class="status-text" id="tap-hint">ğŸ‘† è½»è§¦æŒ‰é’®å¼€å§‹æ¢ç´¢</div>
    </div>

    <!-- éiOSæç¤º -->
    <div id="ios-warning" style="display: none; color: #e74c3c;">
        <p>âš ï¸ è¯·ä½¿ç”¨iPhone/iPadä¸Šçš„Safariæµè§ˆå™¨è®¿é—®æœ¬é¡µé¢</p>
    </div>

    <script>
        // è®¾å¤‡æ£€æµ‹
        const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const $ = selector => document.querySelector(selector);

        if (!isiOS) {
            document.getElementById('ios-warning').style.display = 'block';
        } else {
            // é™é»˜é¢„åŠ è½½USDZæ–‡ä»¶
            let loadProgress = 0;
            const xhr = new XMLHttpRequest();
            
            xhr.open('GET', 'xingzhenglou.usdz', true);
            xhr.responseType = 'blob';

            // è¿›åº¦æ›´æ–°
            xhr.addEventListener('progress', e => {
                if (e.lengthComputable) {
                    loadProgress = Math.round((e.loaded / e.total) * 100);
                    $('#loading-text').textContent = `æ¨¡å‹åŠ è½½ä¸­... (${loadProgress}%)`;
                    $('.progress-fill').style.width = `${loadProgress}%`;
                }
            });

            // åŠ è½½å®Œæˆ
            xhr.addEventListener('load', () => {
                // éšè—åŠ è½½ç•Œé¢
                $('.loading-container').style.display = 'none';
                
                // æ˜¾ç¤ºä¸»å†…å®¹
                $('#main-content').style.display = 'block';
                
                // æ·»åŠ å‘¼å¸åŠ¨ç”»æç¤º
                $('#tap-hint').style.animation = 'breath 1.5s ease infinite';
                
                // è‡ªåŠ¨æ»šåŠ¨åˆ°æŒ‰é’®ä½ç½®
                setTimeout(() => {
                    $('#ar-button').scrollIntoView({ behavior: 'smooth' });
                }, 500);
            });

            // å¼€å§‹åŠ è½½
            xhr.send();
        }

        // å‘¼å¸åŠ¨ç”»å…³é”®å¸§
        const style = document.createElement('style');
        style.textContent = `
            @keyframes breath {
                0% { opacity: 0.6; transform: scale(0.98); }
                50% { opacity: 1; transform: scale(1.02); }
                100% { opacity: 0.6; transform: scale(0.98); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>