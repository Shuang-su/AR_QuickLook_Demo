<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR行政楼预览</title>
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="xingzhenglou.usdz" as="fetch">
    <link rel="preload" href="loading.gif" as="image">

    <!-- 样式 -->
    <style>
        :root {
            --primary-color: #007AFF;
            --text-color: #333;
        }

        body {
            font-family: -apple-system, sans-serif;
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
        }

        /* 加载动画容器 */
        .loading-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }

        /* AR按钮交互效果 */
        .ar-button {
            display: none; /* 默认隐藏 */
            margin: 30px auto;
            padding: 20px 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 15px;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .ar-button:hover {
            transform: translateY(-2px);
        }

        /* 进度条样式 */
        .progress-bar {
            width: 200px;
            height: 4px;
            background: #ddd;
            margin: 20px auto;
            border-radius: 2px;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        /* 状态提示 */
        .status-text {
            color: var(--text-color);
            margin: 15px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading-container">
        <img src="loading.gif" alt="加载中" width="60">
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <p class="status-text" id="loading-text">模型加载中... (0%)</p>
    </div>

    <!-- 主内容（初始隐藏） -->
    <div id="main-content" style="display: none;">
        <h1>行政楼AR预览</h1>
        <p class="status-text">✅ 模型已准备就绪</p>
        
        <a href="xingzhenglou.usdz" rel="ar" class="ar-button" id="ar-button">
            <img src="placeholder.jpg" alt="AR预览" style="width: 280px; border-radius: 8px;">
            <p style="margin-top: 10px;">点击启动AR体验</p>
        </a>

        <div class="status-text" id="tap-hint">👆 轻触按钮开始探索</div>
    </div>

    <!-- 非iOS提示 -->
    <div id="ios-warning" style="display: none; color: #e74c3c;">
        <p>⚠️ 请使用iPhone/iPad上的Safari浏览器访问本页面</p>
    </div>

    <script>
        // 设备检测
        const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const $ = selector => document.querySelector(selector);

        if (!isiOS) {
            document.getElementById('ios-warning').style.display = 'block';
        } else {
            // 静默预加载USDZ文件
            let loadProgress = 0;
            const xhr = new XMLHttpRequest();
            
            xhr.open('GET', 'xingzhenglou.usdz', true);
            xhr.responseType = 'blob';

            // 进度更新
            xhr.addEventListener('progress', e => {
                if (e.lengthComputable) {
                    loadProgress = Math.round((e.loaded / e.total) * 100);
                    $('#loading-text').textContent = `模型加载中... (${loadProgress}%)`;
                    $('.progress-fill').style.width = `${loadProgress}%`;
                }
            });

            // 加载完成
            xhr.addEventListener('load', () => {
                // 隐藏加载界面
                $('.loading-container').style.display = 'none';
                
                // 显示主内容
                $('#main-content').style.display = 'block';
                
                // 添加呼吸动画提示
                $('#tap-hint').style.animation = 'breath 1.5s ease infinite';
                
                // 自动滚动到按钮位置
                setTimeout(() => {
                    $('#ar-button').scrollIntoView({ behavior: 'smooth' });
                }, 500);
            });

            // 开始加载
            xhr.send();
        }

        // 呼吸动画关键帧
        const style = document.createElement('style');
        style.textContent = `
            @keyframes breath {
                0% { opacity: 0.6; transform: scale(0.98); }
                50% { opacity: 1; transform: scale(1.02); }
                100% { opacity: 0.6; transform: scale(0.98); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>